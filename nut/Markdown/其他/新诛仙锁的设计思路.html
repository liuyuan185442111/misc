<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>新诛仙锁的设计思路</title>
<link rel="stylesheet" href="https://stackedit.io/res-min/themes/base.css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body><div class="container"><p>玩家身上有两个变量与此相关： <br>
_haspwd 是否设有密码 <br>
_unlocked 有密码且已解锁为true，有密码且未解锁为false，无密码不关心其值</p>

<pre class="prettyprint"><code class=" hljs asciidoc"><span class="hljs-comment">//为真表示无密码或密码已验证过,直接进入功能</span>
<span class="hljs-comment">//为假表示有密码且密码未验证,直接返回</span>
bool verified()
{
<span class="hljs-code">    return _haspwd &amp;&amp; _unlocked || !_haspwd;</span>
}

<span class="hljs-comment">//客户端用的老接口:在客户端看来是不是有密码</span>
<span class="hljs-comment">//为真表示有密码且未解锁:客户端进入仓库需要弹出密码框;用户点开诛仙锁,解锁按钮呈现可点击状态</span>
<span class="hljs-comment">//为假时:用户可直接进入仓库;用户点开诛仙锁,解锁按钮不可点击</span>
bool has<span class="hljs-emphasis">_password() 
{
    return _</span>hasspwd &amp;&amp; !<span class="hljs-emphasis">_unlocked;
}

</span>根据
A<span class="hljs-code">+BC = (A+</span>B)(A+C)
verified
<span class="hljs-header">= _haspwd &amp;&amp; _unlocked || !_haspwd</span>
<span class="hljs-header">= !_haspwd || (_haspwd &amp;&amp; _unlocked)</span>
<span class="hljs-header">= (!_haspwd || _haspwd) &amp;&amp; (!_haspwd || _unlocked)</span>
<span class="hljs-header">= !_haspwd || _unlocked</span>
<span class="hljs-header">= !(_haspwd || !_unlocked)</span>
<span class="hljs-header">= !has_password</span></code></pre>

<p>若登录时密码为空，_haspwd置为false，has_password为false，verified为true。 <br>
若登录时密码不为空，_haspwd置为true，_unlocked置为false，has_password为true，verified为false。验证密码后，_unlocked置为true，has_password为false，verified为true。 <br>
收到客户的解锁请求时，verified若为true，应是非法请求，不予理睬。</p>

<p>关于修改密码 <br>
变得有密码：与“登录时密码不为空”情况相同。 <br>
变得无密码：与“登录时密码为空”情况相同。</p></div></body>
</html>