<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STL之numeric</title>
<link rel="stylesheet" href="https://stackedit.io/res-min/themes/base.css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body><div class="container"><p>头文件&lt;numeric&gt;在数值序列上定义了一组一般数学操作，也可以用于其他序列。 <br>
有四个函数模板：</p>

<table>
<thead>
<tr>
  <th>name</th>
  <th>description</th>
</tr>
</thead>
<tbody><tr>
  <td>accumulate</td>
  <td>累加和</td>
</tr>
<tr>
  <td>adjacent_difference</td>
  <td>相邻元素之差</td>
</tr>
<tr>
  <td>inner_product</td>
  <td>累加内积</td>
</tr>
<tr>
  <td>partial_sum</td>
  <td>部分和</td>
</tr>
</tbody></table>


<p>对每个操作，你都可以自定义“和”，“差”，“积”的行为，然后传递给函数执行操作的对象。</p>

<h2 id="名词说明">名词说明</h2>

<p>int numbers[] = {10,20,30}; <br>
累加和：10+20+30</p>

<p>x表示[first,last)中元素，y表示结果序列中元素，相邻元素之差： <br>
y0 = x0  <br>
y1 = x1 - x0  <br>
y2 = x2 - x1  <br>
y3 = x3 - x2  <br>
y4 = x4 - x3  <br>
… … …</p>

<p>int series1[] = {10,20,30}; <br>
int series2[] = {1,2,3}; <br>
累加内积：10*1+20*2+30*3</p>

<p>x表示[first,last)中元素，y表示结果序列中元素，部分和： <br>
y0 = x0  <br>
y1 = x0 + x1  <br>
y2 = x0 + x1 + x2  <br>
y3 = x0 + x1 + x2 + x3  <br>
y4 = x0 + x1 + x2 + x3 + x4  <br>
… … …</p>



<h2 id="累加">累加</h2>

<p>先看累加和，累加内积（stl_numeric.h）：</p>

<pre class="prettyprint"><code class="language-cpp hljs "><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIterator, <span class="hljs-keyword">typename</span> T&gt;
T accumulate(InputIterator first, InputIterator last, T init)
{
    <span class="hljs-keyword">for</span> ( ; first != last; ++first)
        init = init + *first;
    <span class="hljs-keyword">return</span> init;
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIterator, <span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> BinaryOperation&gt;
T accumulate(InputIterator first, InputIterator last, T init,
             BinaryOperation binary_op)
{
    <span class="hljs-keyword">for</span> ( ; first != last; ++first)
        init = binary_op(init, *first);
    <span class="hljs-keyword">return</span> init;
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIterator1, <span class="hljs-keyword">typename</span> InputIterator2, <span class="hljs-keyword">typename</span> T&gt;
T inner_product(InputIterator1 first1, InputIterator1 last1,
                InputIterator2 first2, T init)
{
    <span class="hljs-keyword">for</span> ( ; first1 !=last1; ++first1, ++first2)
        init = init + (*first1 **first2);
    <span class="hljs-keyword">return</span> init;
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIterator1, <span class="hljs-keyword">typename</span> InputIterator2, <span class="hljs-keyword">typename</span> T,
         <span class="hljs-keyword">typename</span> BinaryOperation1, <span class="hljs-keyword">typename</span> BinaryOperation2&gt;
T inner_product(InputIterator1 first1, InputIterator1 last1,
                InputIterator2 first2, T init,
                BinaryOperation1 binary_op1,
                BinaryOperation2 binary_op2)
{
    <span class="hljs-keyword">for</span> ( ; first1 != last1; ++first1, ++first2)
        init = binary_op1(init, binary_op2(*first1, *first2));
    <span class="hljs-keyword">return</span> init;
}</code></pre>



<h2 id="部分和">部分和</h2>

<p>在stl_numeric.h中实现：</p>

<pre class="prettyprint"><code class="language-cpp hljs "><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> InputIterator, <span class="hljs-keyword">class</span>  OutputIterator, <span class="hljs-keyword">typename</span> T&gt;
OutputIterator
__partial_sum(InputIterator first, InputIterator last,
              OutputIterator result, T*)
{
    T value = *first;
    <span class="hljs-keyword">while</span>(++first != last)
    {
        value = value + *first;
        *++result = value;
    }
    <span class="hljs-keyword">return</span> ++result;
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIterator, <span class="hljs-keyword">typename</span> OutputIterator&gt;
OutputIterator
partial_sum(InputIterator first, InputIterator last,
            OutputIterator result)
{
    <span class="hljs-keyword">if</span>(first == last) <span class="hljs-keyword">return</span> result;
    *result = *first;
    <span class="hljs-keyword">return</span> __partial_sum(first, last, result, value_type(first));
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIterator, <span class="hljs-keyword">typename</span> OutputIterator, <span class="hljs-keyword">typename</span> T,
         <span class="hljs-keyword">typename</span> BinaryOperation&gt;
OutputIterator
__partial_sum(InputIterator first, InputIterator last,
              OutputIterator result, T*, BinaryOperation binary_op)
{
    T value = *first;
    <span class="hljs-keyword">while</span> (++first != last)
    {
        value = binary_op(value, *first);
        *++result =value;
    }
    <span class="hljs-keyword">return</span> ++result;
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIterator, <span class="hljs-keyword">typename</span> OutputIterator, <span class="hljs-keyword">typename</span> BinaryOperation&gt;
OutputIterator
partial_sum(InputIterator first, InputIterator last,
            OutputIterator result, BinaryOperation binary_op)
{
    <span class="hljs-keyword">if</span>(first == last) <span class="hljs-keyword">return</span> result;
    *result = *first;
    <span class="hljs-keyword">return</span> __partial_sum(first, last, result, value_type(first), binary_op);
}</code></pre>



<h2 id="相邻元素之差">相邻元素之差</h2>

<pre class="prettyprint"><code class="language-cpp hljs "><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIterator, <span class="hljs-keyword">typename</span> OutputIterator, <span class="hljs-keyword">typename</span> T&gt;
OutputIterator
__adjacent_difference(InputIterator first,InputIterator last,
                      OutputIterator result, T*)
{
    T value = *first;
    <span class="hljs-keyword">while</span>(++first != last)
    {
        T tmp = *first;
        *++result = tmp - value;
        value = tmp;
    }
    <span class="hljs-keyword">return</span> ++result;
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIterator, <span class="hljs-keyword">typename</span> OutputIterator&gt;
OutputIterator
adjacent_difference(InputIterator first, InputIterator last, OutputIterator result)
{
    <span class="hljs-keyword">if</span>(first == last) <span class="hljs-keyword">return</span> result;
    *result = *first;
    <span class="hljs-keyword">return</span> __adjacent_difference(first, last, result, value_type(first));
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIterator, <span class="hljs-keyword">typename</span> OutputIterator, <span class="hljs-keyword">typename</span> T,
         <span class="hljs-keyword">typename</span> BinaryOperation&gt;
OutputIterator
__adjacent_difference(InputIterator first, InputIterator last,
                      OutputIterator result, T*,
                      BinaryOperation binary_op)
{
    T value = *first;
    <span class="hljs-keyword">while</span>(++first != last)
    {
        T tmp = *first;
        *++result = binary_op(tmp,value);
        value = tmp;
    }
    <span class="hljs-keyword">return</span> ++result;
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> InputIterator, <span class="hljs-keyword">typename</span> OutputIterator, <span class="hljs-keyword">typename</span> BinaryOperation&gt;
OutputIterator
adjacent_difference(InputIterator first, InputIterator last,
                    OutputIterator result, BinaryOperation binary_op)
{
    <span class="hljs-keyword">if</span>(first == last) <span class="hljs-keyword">return</span> result;
    *result = *first;
    <span class="hljs-keyword">return</span> __adjacent_difference(first, last, result, value_type(first), binary_op);
}</code></pre></div></body>
</html>