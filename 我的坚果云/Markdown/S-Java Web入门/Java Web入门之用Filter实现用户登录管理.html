<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Java Web入门之用Filter实现用户登录管理</title>
<link rel="stylesheet" href="https://stackedit.io/res-min/themes/base.css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body><div class="container"><p>很简单的用户登录管理，设定登陆成功在session里写入super属性来存储权限信息，所以只有登陆成功后session里才会有super这个属性。</p>

<h2 id="filterchain的逻辑">FilterChain的逻辑</h2>

<p>1、/login.html过滤器 <br>
这个过滤器一定要放在/*过滤器之前，否则会造成死循环。</p>

<pre class="prettyprint"><code class="language-java hljs ">Object logined = session.getAttribute(<span class="hljs-string">"super"</span>);
<span class="hljs-keyword">if</span> (logined == <span class="hljs-keyword">null</span>)
    forward to <span class="hljs-string">"/login.html"</span>;
<span class="hljs-keyword">else</span>
    redirect to <span class="hljs-string">"/main.html"</span>;</code></pre>

<p>2、/check.jsp过滤器 <br>
这个过滤器一定要放在/*过滤器之前，否则会造成无法验证登陆。</p>

<pre class="prettyprint"><code class="language-java hljs ">Object logined = session.getAttribute(<span class="hljs-string">"super"</span>);
<span class="hljs-keyword">if</span> (logined == <span class="hljs-keyword">null</span>)
    forward to <span class="hljs-string">"/check.html"</span>;
<span class="hljs-keyword">else</span>
    redirect to <span class="hljs-string">"/main.html"</span>;</code></pre>

<p>3、/*过滤器</p>

<pre class="prettyprint"><code class="language-java hljs ">Object logined = session.getAttribute(<span class="hljs-string">"super"</span>);
<span class="hljs-keyword">if</span> (logined == <span class="hljs-keyword">null</span>)
    redirect to <span class="hljs-string">"/login.html"</span>;
<span class="hljs-keyword">else</span>
    chain.doFilter(request, response);</code></pre>

<p><br>1-2顺序可变，但一定要在3之前；3之后的过滤器顺序可变，但一定要在3之后。</p>



<h2 id="checkjsp">check.jsp</h2>

<pre class="prettyprint"><code class="language-java hljs ">&lt;%@ page contentType=<span class="hljs-string">"text/html;charset=UTF-8"</span> pageEncoding=<span class="hljs-string">"utf-8"</span> %&gt;
&lt;html&gt;
    &lt;meta http-equiv=Content-Type content=<span class="hljs-string">"text/html;charset=utf-8"</span>&gt;
&lt;head&gt;
    &lt;title&gt;check&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;%
    response.setHeader(<span class="hljs-string">"progma"</span>,<span class="hljs-string">"no-cache"</span>);
    response.setHeader(<span class="hljs-string">"Cache-Control"</span>,<span class="hljs-string">"no-cache"</span>);
    response.setDateHeader(<span class="hljs-string">"Expires"</span>,<span class="hljs-number">0</span>);
    String username = request.getParameter(<span class="hljs-string">"username"</span>);
    String password = request.getParameter(<span class="hljs-string">"password"</span>);
    <span class="hljs-keyword">if</span> (username == <span class="hljs-keyword">null</span> || password == <span class="hljs-keyword">null</span>)
        response.sendRedirect(request.getContextPath()+<span class="hljs-string">"/login.html"</span>);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (username.equals(<span class="hljs-string">"admin"</span>) &amp;&amp; password.equals(<span class="hljs-string">"123"</span>)) {
        session.setAttribute(<span class="hljs-string">"super"</span>,<span class="hljs-string">"super"</span>);
        response.sendRedirect(request.getContextPath()+<span class="hljs-string">"/main.html"</span>);
    }
    <span class="hljs-keyword">else</span> {
        response.setHeader(<span class="hljs-string">"refresh"</span>,<span class="hljs-string">"3;url=login.html"</span>);
    %&gt;
    用户不存在或密码错误，<span class="hljs-number">3</span>秒后自动返回登陆界面。&lt;br&gt;
    如果没有返回，请点击&lt;a href=<span class="hljs-string">"login.html"</span>&gt;此处&lt;/a&gt;。
    &lt;%}%&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

<h2 id="loginhtml">login.html</h2>

<pre class="prettyprint"><code class="language-html hljs "><span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">Content-Type</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"text/html;charset=utf-8"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"pragma"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"no-cache"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"cache-control"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"no-cache"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"expires"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"0"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>login<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="javascript">
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Check</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">with</span>(document.info) {
            <span class="hljs-keyword">var</span> uname = username.value;
            <span class="hljs-keyword">var</span> psd = password.value;
            <span class="hljs-keyword">if</span>(uname == <span class="hljs-literal">null</span> || uname == <span class="hljs-string">""</span>) alert(<span class="hljs-string">"用户名为空"</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (psd == <span class="hljs-literal">null</span> || psd == <span class="hljs-string">""</span>) alert(<span class="hljs-string">"密码为空"</span>);
            <span class="hljs-keyword">else</span> submit();
        }
    }
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">center</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"info"</span> <span class="hljs-attribute">action</span>=<span class="hljs-value">"check.jsp"</span> <span class="hljs-attribute">method</span>=<span class="hljs-value">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">table</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">td</span> <span class="hljs-attribute">colspan</span>=<span class="hljs-value">"2"</span> <span class="hljs-attribute">align</span>=<span class="hljs-value">"center"</span>&gt;</span>用户登录<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>登录名：<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"username"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>密码：<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"password"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"password"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">table</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"button"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"登录"</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"Check()"</span>&gt;</span>&amp;nbsp;&amp;nbsp;&amp;nbsp;
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"reset"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"重置"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></code></pre>

<p>注意，check.jsp和login.html里需要设置页面不缓存。 <br>
check.jsp密码验证部分应当从数据库里取用户名、密码、权限信息等，这里为方便简化了。</p></div></body>
</html>