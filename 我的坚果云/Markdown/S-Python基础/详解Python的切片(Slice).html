<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>详解Python的切片(Slice)</title>
<link rel="stylesheet" href="https://stackedit.io/res-min/themes/base.css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body><div class="container"><p>先看例子：</p>



<pre class="prettyprint"><code class=" hljs php"><span class="hljs-keyword">array</span> = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
<span class="hljs-keyword">print</span>(<span class="hljs-keyword">array</span>[:])
<span class="hljs-keyword">print</span>(<span class="hljs-keyword">array</span>[::-<span class="hljs-number">1</span>])
<span class="hljs-keyword">print</span>(<span class="hljs-keyword">array</span>[::<span class="hljs-number">2</span>])
<span class="hljs-keyword">print</span>(<span class="hljs-keyword">array</span>[:-<span class="hljs-number">4</span>:-<span class="hljs-number">1</span>])
<span class="hljs-keyword">print</span>(<span class="hljs-keyword">array</span>[-<span class="hljs-number">4</span>:<span class="hljs-number">5</span>])
<span class="hljs-keyword">print</span>(<span class="hljs-keyword">array</span>[-<span class="hljs-number">10</span>:<span class="hljs-number">3</span>])</code></pre>

<p>结果是：</p>

<pre><code>[0, 1, 2, 3, 4, 5]
[5, 4, 3, 2, 1, 0]
[0, 2, 4]
[5, 4, 3]
[2, 3, 4]
[0, 1, 2]
</code></pre>

<p>这就是 Python 的切片（Slice）操作。</p>

<p>切片的语法是：</p>

<pre><code>m[start:stop:step]
</code></pre>

<p>其中：</p>

<pre><code>start，stop，step，:step 均可以省略，省略的 start 和 stop 会被 None 替换，省略的 step 会被 1 替换
m 可以是 list，tuple，str，range，或支持 getitem 等几个方法的自定义类
start 和 stop 可以是 None，整数，或拥有 __index__ 方法的对象（__index__方法须返回一个整数）
step 必须是非零整数
返回一个包含 m 部分元素的副本（浅复制）
</code></pre>

<p>结果的获得：</p>

<pre><code>1) 找到 start 和 stop 在 m 中对应的位置
2) step 为正时，如果 start 为 None，可认为 start 为0，如果 stop 为 None，可认为 stop 为 len(m)；  step 为负时，如果 start 为 None，可认为 start 为 -1，如果 stop 为 None，可认为 stop 为 -1-len(m)
3) step 为正时，stop 应在 start 的右边，step 为负时，stop 应在start 的左边，否则得到空序列
4) 在 [start,stop) 所标识的区间之内以 step 步进取得相应元素
</code></pre>

<p>实际动作相当于（对应后边的简单实现来看）：</p>

<pre><code>1) step 为正时，m 的边界为 [0,len(m))；step 为负时，m 的边界为 [-1,-1-len(m))
2) 如果 start 或 stop 为 None，根据 step 不同将其替换为 m 的边界，比如 start==None and step&gt;0，将 start 替换为 0
3) 如果 start 或 step 的值超出 m 的索引范围，将其限制为 m 的边界
4) 在 [start,stop) 范围内查找相应元素：step 为正时，从左向右找元素；step 为负时，从右向左找元素
</code></pre>



<h2 id="作为左值进行赋值">作为左值进行赋值</h2>

<pre><code>array = [0, 1, 2, 3, 4, 5]
array[2:4] = [8,8,8]
print(array)
# [0, 1, 8, 8, 4, 5]
</code></pre>

<p>对于list有几点需要说明和注意：</p>

<ol>
<li>右侧对象必须是iterable。</li>
<li>step 不为 1 时，= 两侧区间的大小必须相同，新元素将替换旧元素； <br>
step 为 1 时，即切片标识一段从左向右的连续区间，两侧区间大小可以不同，新区间将替换旧区间。</li>
<li>切片标识的区间为空时，将在 start 位置之前插入新区间，此规则不与 规则2 冲突：此时如果 step 不是 1，新区间的大小则必须是 0。</li>
</ol>

<p>例子如下：</p>

<pre><code>array = [0, 1, 2, 3, 4, 5]
array[2:0] = [9.9, 8.8]
print(array)
# [0, 1, 9.9, 8.8, 2, 3, 4, 5]
</code></pre>



<h2 id="自定义类型">自定义类型</h2>

<p>自定义类型如想使用下标运算符[]，需酌情定义以下几个函数：</p>

<pre><code>__getitem__(self, key)
    m[k]  =&gt;  m.__getitem__(k)

__setitem__(self, key, value)
    m[k]=v  =&gt;  m.__setitem__(k,v)

__delitem__(self,key)
    del m[k]  =&gt;  m.__delitem__(k)
</code></pre>

<p>此时[ ]内可接受任何类型参数，[ ]内的切片表达式将自动形成slice实例，比如：</p>

<pre><code>[:]     =&gt;  slice(None,None,None)
[1:3:2] =&gt;  slice(1,3,2)
</code></pre>



<h2 id="附字符串的部分切片实现">附字符串的部分切片实现</h2>

<pre class="prettyprint"><code class=" hljs vbscript"># m是原字符串, 返回切片后的字符串副本
def slice_L(m, start, <span class="hljs-keyword">stop</span>, <span class="hljs-keyword">step</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">step</span>&gt;<span class="hljs-number">0</span>:
        # 将start和<span class="hljs-keyword">stop</span>都调整为正数
        <span class="hljs-keyword">if</span> start==None:
            start=<span class="hljs-number">0</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">stop</span>==None:
            <span class="hljs-keyword">stop</span>=<span class="hljs-built_in">len</span>(m)
        # 如果start太左, 限制为<span class="hljs-number">0</span>
        <span class="hljs-keyword">if</span> start&lt;=-<span class="hljs-built_in">len</span>(m):
            start=<span class="hljs-number">0</span>
        elif -<span class="hljs-built_in">len</span>(m)&lt;start&lt;<span class="hljs-number">0</span>:
            start+=<span class="hljs-built_in">len</span>(m)
        # 如果<span class="hljs-keyword">stop</span>太右, 限制为<span class="hljs-built_in">len</span>(m)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">stop</span>&gt;<span class="hljs-built_in">len</span>(m):
            <span class="hljs-keyword">stop</span>=<span class="hljs-built_in">len</span>(m)
        elif -<span class="hljs-built_in">len</span>(m)&lt;<span class="hljs-keyword">stop</span>&lt;<span class="hljs-number">0</span>:
            <span class="hljs-keyword">stop</span>+=<span class="hljs-built_in">len</span>(m)
        # start太右或<span class="hljs-keyword">stop</span>太左的情况
        <span class="hljs-keyword">if</span> start&gt;=<span class="hljs-keyword">stop</span>:
            return <span class="hljs-comment">''</span>

        s=<span class="hljs-comment">''</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(start,<span class="hljs-keyword">stop</span>,<span class="hljs-keyword">step</span>):
            s+=m[i]
        return s

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">step</span>&lt;<span class="hljs-number">0</span>:
        <span class="hljs-keyword">if</span> start==None:
            start=-<span class="hljs-number">1</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">stop</span>==None:
            <span class="hljs-keyword">stop</span>=-<span class="hljs-number">1</span>-<span class="hljs-built_in">len</span>(m)
        <span class="hljs-keyword">if</span> start&gt;=<span class="hljs-built_in">len</span>(m):
            start=-<span class="hljs-number">1</span>
        elif <span class="hljs-number">0</span>&lt;=start&lt;<span class="hljs-built_in">len</span>(m):
            start-=<span class="hljs-built_in">len</span>(m)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">stop</span>&lt;-<span class="hljs-built_in">len</span>(m):
            <span class="hljs-keyword">stop</span>=-<span class="hljs-number">1</span>-<span class="hljs-built_in">len</span>(m)
        elif <span class="hljs-number">0</span>&lt;=<span class="hljs-keyword">stop</span>&lt;<span class="hljs-built_in">len</span>(m):
            <span class="hljs-keyword">stop</span>-=<span class="hljs-built_in">len</span>(m)
        <span class="hljs-keyword">if</span> start&lt;=<span class="hljs-keyword">stop</span>:
            return <span class="hljs-comment">''</span>
        s=<span class="hljs-comment">''</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(start,<span class="hljs-keyword">stop</span>,<span class="hljs-keyword">step</span>):
            s+=m[i]
        return s</code></pre></div></body>
</html>